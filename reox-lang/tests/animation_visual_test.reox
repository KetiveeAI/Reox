// REOX Animation Visual Test
// Tests the animation and UI system with actual visual output
// File: animation_visual_test.reox

// ============================================================
// Type Definitions
// ============================================================
struct Color { r: int, g: int, b: int, a: int }
struct View { handle: int }
struct App { handle: int }
struct Window { handle: int }
struct EdgeInsets { top: float, right: float, bottom: float, left: float }
struct Shadow { offset_x: float, offset_y: float, blur: float, color: Color }
struct Animation { id: int }

// ============================================================
// External Functions
// ============================================================

// Print
extern fn println(s: string) -> void;
extern fn print(s: string) -> void;

// Colors
extern fn color_rgba(r: int, g: int, b: int, a: int) -> Color;
extern fn color_lighten(c: Color, amount: float) -> Color;
extern fn color_darken(c: Color, amount: float) -> Color;
extern fn color_blend(a: Color, b: Color, t: float) -> Color;

// Geometry
extern fn insets_all(value: float) -> EdgeInsets;
extern fn shadow(x: float, y: float, blur: float, color: Color) -> Shadow;

// Layout
extern fn vstack(gap: float) -> View;
extern fn hstack(gap: float) -> View;
extern fn spacer() -> View;

// Views
extern fn text_view(text: string) -> View;
extern fn button_view(label: string) -> View;

// View modifiers
extern fn view_set_background(v: View, c: Color) -> void;
extern fn view_set_padding(v: View, p: EdgeInsets) -> void;
extern fn view_set_corner_radius(v: View, r: float) -> void;
extern fn view_set_shadow(v: View, s: Shadow) -> void;
extern fn view_set_opacity(v: View, o: float) -> void;
extern fn view_add_child(parent: View, child: View) -> void;

// Text modifiers
extern fn text_set_font_size(v: View, size: float) -> void;
extern fn text_set_font_weight(v: View, weight: int) -> void;
extern fn text_set_color(v: View, c: Color) -> void;

// Button modifiers
extern fn button_set_style(v: View, normal: Color, hover: Color, pressed: Color) -> void;

// Animation
extern fn rx_view_fade_in(v: View, duration: float) -> Animation;
extern fn rx_view_fade_out(v: View, duration: float) -> Animation;
extern fn rx_view_slide_in(v: View, from_x: float, from_y: float, duration: float) -> Animation;
extern fn rx_view_bounce(v: View, duration: float) -> Animation;
extern fn rx_view_pulse(v: View, duration: float) -> Animation;
extern fn rx_view_shake(v: View, duration: float) -> Animation;

// Animation scheduler
extern fn rx_animator_update(dt: float) -> void;

// App & Window
extern fn app_new(name: string) -> App;
extern fn app_create_window(a: App, title: string, w: int, h: int) -> Window;
extern fn app_run(a: App) -> void;
extern fn window_set_root(win: Window, v: View) -> void;

// Timing
extern fn delay_ms(ms: int) -> void;

// ============================================================
// Build Test UI
// ============================================================
fn build_animated_card(title: string, description: string, primary: Color) -> View {
    let card: View = vstack(8.0);
    view_set_background(card, color_rgba(40, 42, 54, 255));
    view_set_padding(card, insets_all(20.0));
    view_set_corner_radius(card, 16.0);
    view_set_shadow(card, shadow(0.0, 8.0, 24.0, color_rgba(0, 0, 0, 100)));
    
    // Title
    let title_view: View = text_view(title);
    text_set_font_size(title_view, 18.0);
    text_set_font_weight(title_view, 600);
    text_set_color(title_view, primary);
    view_add_child(card, title_view);
    
    // Description
    let desc_view: View = text_view(description);
    text_set_font_size(desc_view, 12.0);
    text_set_color(desc_view, color_rgba(180, 180, 180, 255));
    view_add_child(card, desc_view);
    
    return card;
}

fn main() -> int {
    println("========================================");
    println("REOX Animation Visual Test");
    println("========================================");
    println("");
    
    // Create application
    let app: App = app_new("REOX Animation Test");
    let window: Window = app_create_window(app, "Animation Demo", 800, 600);
    
    // Define color palette
    let bg: Color = color_rgba(26, 27, 38, 255);
    let purple: Color = color_rgba(139, 92, 246, 255);
    let pink: Color = color_rgba(236, 72, 153, 255);
    let cyan: Color = color_rgba(34, 211, 238, 255);
    let green: Color = color_rgba(34, 197, 94, 255);
    
    // Root container
    let root: View = vstack(24.0);
    view_set_background(root, bg);
    view_set_padding(root, insets_all(32.0));
    
    // Title section
    let title: View = text_view("Animation System Test");
    text_set_font_size(title, 28.0);
    text_set_font_weight(title, 700);
    text_set_color(title, color_rgba(255, 255, 255, 255));
    view_add_child(root, title);
    
    let subtitle: View = text_view("Demonstrating REOX animation capabilities");
    text_set_font_size(subtitle, 14.0);
    text_set_color(subtitle, color_rgba(160, 160, 170, 255));
    view_add_child(root, subtitle);
    
    // Card row
    let cards: View = hstack(16.0);
    
    // Fade card
    let fade_card: View = build_animated_card("Fade", "Opacity transitions", purple);
    view_add_child(cards, fade_card);
    
    // Slide card
    let slide_card: View = build_animated_card("Slide", "Position animations", pink);
    view_add_child(cards, slide_card);
    
    // Bounce card
    let bounce_card: View = build_animated_card("Bounce", "Spring physics", cyan);
    view_add_child(cards, bounce_card);
    
    // Pulse card
    let pulse_card: View = build_animated_card("Pulse", "Scale effects", green);
    view_add_child(cards, pulse_card);
    
    view_add_child(root, cards);
    
    // Button row
    let buttons: View = hstack(12.0);
    
    let btn1: View = button_view("Fade In");
    button_set_style(btn1, purple, color_lighten(purple, 0.2), color_darken(purple, 0.2));
    view_add_child(buttons, btn1);
    
    let btn2: View = button_view("Slide In");
    button_set_style(btn2, pink, color_lighten(pink, 0.2), color_darken(pink, 0.2));
    view_add_child(buttons, btn2);
    
    let btn3: View = button_view("Bounce");
    button_set_style(btn3, cyan, color_lighten(cyan, 0.2), color_darken(cyan, 0.2));
    view_add_child(buttons, btn3);
    
    let btn4: View = button_view("Pulse");
    button_set_style(btn4, green, color_lighten(green, 0.2), color_darken(green, 0.2));
    view_add_child(buttons, btn4);
    
    view_add_child(root, buttons);
    
    // Footer
    let footer: View = text_view("REOX UI Framework for NeolyxOS");
    text_set_font_size(footer, 11.0);
    text_set_color(footer, color_rgba(100, 100, 110, 255));
    view_add_child(root, footer);
    
    // Set window root
    window_set_root(window, root);
    
    // Apply entrance animations
    println("Applying entrance animations...");
    
    // Fade in title
    rx_view_fade_in(title, 0.5);
    
    // Slide in cards from different directions
    rx_view_slide_in(fade_card, -50.0, 0.0, 0.4);
    rx_view_slide_in(slide_card, 0.0, 50.0, 0.5);
    rx_view_slide_in(bounce_card, 50.0, 0.0, 0.6);
    rx_view_slide_in(pulse_card, 0.0, -50.0, 0.7);
    
    // Bounce buttons
    rx_view_bounce(btn1, 0.3);
    rx_view_bounce(btn2, 0.35);
    rx_view_bounce(btn3, 0.4);
    rx_view_bounce(btn4, 0.45);
    
    println("Animations queued!");
    println("");
    println("Running application event loop...");
    
    // Run application
    app_run(app);
    
    println("Animation test complete.");
    return 0;
}
